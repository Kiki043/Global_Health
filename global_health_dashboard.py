"""
Global Health Indicators Dashboard
Dimensionality Reduction Analysis (1990-2019)

Assessment 3 - Data Analytics and Visualisation
"""

import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px
import plotly.graph_objects as go

# Page configuration
st.set_page_config(
    page_title="Global Health Explorer",
    page_icon="üåç",
    layout="wide",
    initial_sidebar_state="expanded"
)

# Custom CSS
st.markdown("""
<style>
    @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Space+Mono&display=swap');
    
    .main { background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%); }
    .stApp { background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%); }
    h1, h2, h3 { font-family: 'DM Sans', sans-serif !important; color: #e8e8e8 !important; }
    
    .main-header {
        font-size: 2.8rem; font-weight: 700;
        background: linear-gradient(120deg, #00d4aa, #7c3aed, #f472b6);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        margin-bottom: 0.5rem;
    }
    .sub-header { color: #a0a0a0 !important; font-size: 1.1rem; margin-bottom: 2rem; }
    
    .metric-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px; padding: 1.5rem; margin: 0.5rem 0;
        backdrop-filter: blur(10px);
    }
    
    .cluster-badge {
        display: inline-block; padding: 0.25rem 0.75rem;
        border-radius: 20px; font-size: 0.8rem; font-weight: 600;
    }
    .cluster-0 { background: #00d4aa; color: #0f0f23; }
    .cluster-1 { background: #ef4444; color: white; }
    .cluster-2 { background: #f59e0b; color: #0f0f23; }
    .cluster-3 { background: #8b5cf6; color: white; }
    
    div[data-testid="stMetricValue"] { font-family: 'Space Mono', monospace; }
</style>
""", unsafe_allow_html=True)

# ============== DATA ==============
@st.cache_data
def load_data():
    data = {
        "countries": ["Afghanistan", "Albania", "Algeria", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan", "Bahamas", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bosnia and Herzegovina", "Botswana", "Brazil", "Bulgaria", "Burkina Faso", "Cambodia", "Cameroon", "Canada", "Cape Verde", "Central African Republic", "Chad", "Chile", "China", "Colombia", "Congo", "Costa Rica", "Cote d'Ivoire", "Croatia", "Cuba", "Cyprus", "Czechia", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "Ecuador", "Egypt", "El Salvador", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Lithuania", "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Mauritania", "Mauritius", "Mexico", "Moldova", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar", "Namibia", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Korea", "Norway", "Oman", "Pakistan", "Panama", "Paraguay", "Peru", "Philippines", "Poland", "Portugal", "Romania", "Russia", "Rwanda", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "Sao Tome and Principe", "Saudi Arabia", "Senegal", "Serbia", "Sierra Leone", "Slovakia", "Slovenia", "Solomon Islands", "South Africa", "South Korea", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Tajikistan", "Tanzania", "Thailand", "Togo", "Trinidad and Tobago", "Tunisia", "Turkey", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", "Uruguay", "Uzbekistan", "Vanuatu", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"],
        "clusters": [1, 2, 2, 1, 3, 2, 2, 0, 0, 2, 3, 1, 3, 2, 0, 3, 1, 2, 1, 3, 2, 1, 1, 1, 0, 3, 1, 1, 2, 3, 3, 1, 3, 1, 0, 3, 0, 0, 0, 1, 3, 3, 3, 2, 3, 2, 1, 1, 3, 0, 0, 1, 1, 2, 0, 1, 0, 3, 3, 1, 1, 3, 1, 3, 2, 0, 3, 1, 2, 2, 0, 0, 0, 3, 0, 2, 2, 1, 3, 0, 2, 1, 2, 0, 1, 1, 2, 0, 1, 1, 3, 3, 1, 0, 1, 3, 3, 2, 1, 0, 2, 1, 1, 1, 1, 0, 0, 3, 1, 1, 1, 0, 0, 1, 3, 3, 3, 3, 2, 0, 2, 2, 1, 3, 3, 3, 3, 0, 1, 2, 1, 2, 0, 3, 1, 0, 0, 3, 1, 3, 0, 0, 2, 1, 3, 1, 3, 2, 2, 1, 2, 0, 0, 0, 2, 2, 3, 3, 3, 1, 1, 1],
        "cluster_labels": {"0": "Developed Nations", "1": "Least Developed", "2": "Emerging Economies", "3": "Developing Nations"},
        "embeddings": {
            "PCA": {
                "x": [-9.041, 2.94, 0.57, -9.087, 3.777, 3.853, 1.911, 6.905, 8.218, -0.71, 4.993, -5.093, 4.236, 4.302, 7.173, 1.678, -7.314, 3.14, -2.898, 1.622, 3.228, -7.39, -5.6, -7.605, 6.944, -0.571, -11.149, -10.405, 3.507, 1.083, 1.325, -6.331, 3.491, -5.299, 4.759, 2.953, 5.65, 5.697, 8.082, -5.691, 2.706, -0.135, 0.64, 0.4, -0.007, 5.241, -6.62, -8.819, -0.16, 7.253, 7.331, -4.203, -6.059, 0.84, 7.531, -5.592, 7.315, 2.593, -1.63, -9.097, -9.539, -1.392, -6.533, -0.891, 4.823, 8.118, -4.439, -3.104, 2.143, -1.648, 7.038, 6.092, 7.461, 2.176, 5.89, 1.422, 1.235, -6.08, -3.634, 4.772, 0.091, -5.877, 4.301, 3.838, -8.536, -8.833, 4.388, 9.885, -6.857, -8.262, 2.169, 1.433, -8.581, 6.043, -5.855, 1.983, 1.661, 1.2, -2.332, 5.765, -0.614, -9.679, -5.097, -4.88, -4.733, 7.623, 6.449, -1.342, -9.135, -9.463, -1.894, 8.279, 2.157, -5.662, 1.36, 0.227, -0.32, -2.128, 4.631, 6.582, 3.339, 2.933, -7.895, 3.035, 2.227, 0.945, -3.387, 1.961, -5.239, 3.341, -12.055, 4.376, 6.277, -2.811, -2.946, 4.419, 6.819, 0.047, -3.569, 0.406, 7.396, 8.188, -2.828, -6.058, 1.411, -6.155, 1.444, 1.629, 3.235, -5.993, 2.215, 4.93, 6.537, 6.469, 2.789, 0.215, -1.632, 0.633, -1.204, -4.4, -6.505, -5.81],
                "y": [0.116, 2.918, 4.235, -3.372, -1.137, -0.417, 3.585, -2.856, -3.575, 4.136, -1.304, 2.34, -0.648, -0.41, -2.551, 0.829, -1.511, 2.717, -0.187, 0.117, 0.838, -0.579, 1.249, -1.54, -2.099, 0.454, -4.739, -3.383, 1.676, 3.749, 0.124, -2.362, -0.358, -1.082, -0.05, 1.932, -0.848, -1.438, -4.426, -0.312, 0.193, -0.65, -0.66, 6.475, 1.49, -1.247, -0.88, -0.778, 1.584, -3.538, -2.943, -1.115, -0.838, 2.835, -3.553, -1.372, 0.3, -0.867, 1.435, -2.086, -2.027, 1.45, -1.071, 0.934, -1.094, -4.226, 2.407, 2.182, 5.157, 3.194, -2.653, 0.728, -0.68, 0.329, -1.577, 3.022, 1.734, -0.949, -0.473, 1.715, 2.244, 1.08, -0.663, 3.324, 0.283, -3.457, 0.256, -5.492, -0.622, -0.861, 1.424, 0.119, -0.787, 0.197, -0.415, 2.052, 1.563, 1.619, -0.295, 1.196, 5.623, -2.677, 0.752, -0.94, 1.683, -3.65, -1.797, 0.546, -1.249, -3.228, 2.269, -4.097, 3.92, 1.086, -0.605, -0.693, 0.846, 1.534, 0.488, -1.169, 1.662, 1.208, -2.487, -0.846, 0.162, -1.525, -0.803, 4.013, -0.279, 0.797, -4.946, -0.37, -0.6, 0.271, 0.817, 2.602, -1.963, 2.347, 0.456, 0.434, -3.838, -4.062, 2.281, -0.966, 1.404, -0.393, 0.344, 4.126, 4.989, -1.33, 0.985, 2.135, -2.973, -2.994, -0.66, 3.562, -0.045, 0.081, 2.237, 2.054, -0.36, -0.65]
            },
            "t-SNE": {
                "x": [-0.087, 5.638, 6.304, -3.43, -2.215, 0.453, 5.27, 2.672, 4.355, 4.926, -1.075, -0.815, -0.065, 7.33, 3.381, -4.55, -3.344, 3.348, -5.433, 0.405, 3.777, -1.733, -1.268, -3.586, 2.035, -0.502, -3.107, -1.315, 1.107, -7.745, 1.913, -4.663, -3.325, -5.762, 2.906, 1.522, 0.449, 3.889, 4.263, -2.675, -4.595, -1.871, -1.885, 7.332, 1.364, 6.099, -6.696, -0.489, -3.35, 4.468, 1.927, -6.523, -1.953, 4.195, 3.916, -5.934, 0.696, -1.812, 1.281, -1.842, -2.021, -2.416, -3.363, 1.115, 3.714, 2.917, -7.686, -1.084, 6.947, 4.717, 2.184, 0.13, 0.996, -0.385, 3.566, 1.921, 3.899, -4.573, -4.924, -1.871, 4.109, -1.105, 6.269, 0.336, -7.201, -2.488, 5.987, 3.31, -3.086, -2.808, -1.441, -1.111, -1.581, 1.632, -1.354, 0.795, 1.427, 4.321, -5.234, 1.76, 6.579, -3.336, -1.862, -5.929, -1.624, 2.974, 2.651, -0.155, -1.444, -1.792, -1.857, 3.598, -3.743, -2.993, -0.992, -0.27, -0.981, -1.179, 5.943, 2.518, 4.051, 5.202, 1.174, -0.944, -0.509, -4.252, -3.269, -3.388, -2.132, 3.111, -1.465, 3.536, 2.592, -4.306, -6.853, -1.22, 1.882, -1.017, -3.511, -0.776, 3.496, 3.063, 4.157, -4.832, -2.601, -3.977, 0.119, 6.484, 7.236, -6.863, 5.417, -2.037, 2.408, 1.354, 0.69, 4.547, -4.168, 0.215, -1.009, -3.235, -5.165, -4.943],
                "y": [12.979, -1.79, 0.523, 13.593, -2.622, -3.476, -1.513, -10.005, -9.868, -0.315, -4.17, 8.042, -2.686, -6.23, -9.403, -2.761, 12.347, -3.392, 7.824, 0.29, -4.425, 11.835, 8.156, 12.137, -9.589, 1.911, 14.307, 13.656, -2.485, 3.533, 3.243, 12.025, -0.348, 12.531, -5.777, -0.574, -6.614, -6.598, -11.508, 9.266, -2.824, 0.973, 1.317, -0.417, 2.632, -6.665, 8.497, 12.285, 3.086, -10.963, -9.985, 12.863, 10.455, -1.951, -10.106, 12.759, -8.313, -2.272, 2.072, 15.629, 13.336, 3.084, 11.033, 2.554, -5.838, -12.151, 3.694, 6.646, -0.996, 1.93, -11.366, -8.065, -8.802, -1.393, -8.662, -1.787, -1.551, 10.262, 4.546, -6.933, -1.3, 8.966, -6.691, -5.298, 9.015, 13.464, -5.87, -13.062, 10.676, 11.894, -0.296, -0.652, 12.321, -7.53, 10.723, -0.854, 1.156, -2.679, 6.124, -6.214, 1.283, 13.141, 8.038, 8.292, 8.679, -10.537, -9.371, 2.346, 12.396, 15.501, 6.373, -11.911, -6.295, 8.876, 0.86, 1.251, 2.059, 5.558, -5.712, -8.149, -3.629, -4.196, 11.122, -2.246, -1.723, 1.638, 5.033, -6.354, 10.022, -4.333, 14.956, -5.581, -6.863, 3.672, 8.134, -6.075, -8.79, 3.061, 7.925, 0.217, -10.68, -11.22, 1.019, 10.633, 0.015, 11.147, -0.499, 0.011, -1.222, 12.691, -4.173, -7.051, -10.61, -10.987, -3.04, -0.378, 3.616, 1.054, 5.702, 8.302, 9.66, 9.601]
            },
            "UMAP": {
                "x": [-13.425, -20.219, -20.031, -14.212, -18.437, -18.91, -20.404, -20.799, -20.881, -20.197, -18.624, -15.024, -18.893, -21.431, -20.564, -17.833, -14.058, -20.603, -15.562, -17.746, -21.086, -13.998, -15.115, -14.153, -20.271, -16.751, -14.024, -13.483, -19.565, -20.811, -17.353, -14.973, -17.737, -14.825, -20.659, -18.115, -19.366, -20.984, -21.286, -14.857, -18.516, -17.457, -17.35, -20.089, -17.281, -21.347, -15.341, -13.64, -16.328, -21.37, -20.408, -15.058, -14.049, -20.67, -21.028, -14.57, -20.074, -18.362, -17.031, -13.754, -13.822, -15.925, -14.595, -17.167, -21.165, -21.097, -14.866, -15.564, -19.686, -16.846, -20.751, -19.735, -20.133, -17.964, -20.322, -19.604, -21.035, -14.784, -15.907, -19.284, -20.59, -14.641, -21.343, -19.443, -14.947, -13.839, -21.197, -21.126, -14.722, -14.328, -17.695, -18.075, -13.695, -19.891, -13.961, -20.505, -17.187, -20.941, -16.051, -20.229, -20.207, -13.891, -15.141, -15.313, -14.746, -20.805, -20.468, -17.007, -13.586, -13.783, -15.557, -21.211, -19.041, -14.158, -17.61, -17.459, -16.62, -15.373, -21.331, -20.696, -21.02, -21.457, -14.502, -18.136, -18.627, -17.701, -15.864, -19.373, -14.426, -20.755, -13.543, -20.903, -20.393, -15.911, -15.5, -19.506, -20.054, -16.477, -14.339, -17.387, -21.104, -20.984, -16.489, -14.677, -17.151, -14.45, -17.706, -20.122, -19.85, -14.799, -21.362, -19.347, -20.655, -20.535, -19.166, -20.366, -16.248, -17.524, -15.785, -14.446, -15.162, -14.975],
                "y": [-3.09, -5.638, -5.224, -3.129, -6.481, -6.723, -5.408, -7.561, -7.234, -5.168, -6.838, -4.439, -6.572, -6.329, -7.13, -6.701, -2.851, -5.831, -3.925, -6.697, -5.865, -3.563, -4.238, -3.222, -7.217, -6.01, -2.897, -3.284, -5.848, -5.173, -6.836, -3.088, -6.208, -3.236, -6.257, -6.207, -6.765, -6.545, -7.378, -3.911, -6.835, -6.196, -6.103, -5.096, -6.665, -6.461, -3.67, -2.997, -4.686, -6.968, -7.348, -3.391, -3.709, -5.352, -7.164, -2.736, -6.717, -6.781, -6.695, -3.187, -3.546, -4.631, -3.681, -6.518, -6.176, -7.96, -4.667, -4.587, -5.37, -4.296, -7.655, -6.321, -6.976, -6.63, -7.575, -5.474, -5.296, -3.589, -4.271, -6.103, -5.242, -4.29, -6.093, -5.963, -3.764, -3.103, -6.004, -7.922, -3.152, -3.102, -5.586, -6.296, -3.266, -6.505, -3.897, -5.693, -6.79, -5.462, -4.025, -6.327, -4.88, -2.967, -4.145, -3.643, -4.033, -7.571, -7.147, -6.347, -3.403, -3.334, -4.154, -7.86, -5.596, -4.187, -6.358, -6.611, -5.908, -4.193, -6.187, -6.673, -5.693, -5.743, -3.05, -6.647, -6.358, -5.943, -3.91, -5.393, -3.964, -6.011, -3.22, -6.312, -6.776, -4.561, -3.866, -5.776, -7.101, -5.58, -3.936, -5.727, -7.631, -7.73, -4.264, -3.227, -5.603, -3.502, -6.323, -5.297, -5.438, -2.976, -5.678, -6.077, -7.364, -7.744, -6.334, -5.039, -4.691, -6.613, -5.033, -4.243, -3.591, -3.487]
            },
            "Isomap": {
                "x": [13.716, -4.272, -0.955, 15.45, -4.718, -6.459, -3.255, -9.935, -12.473, 0.824, -8.138, 6.944, -5.252, -10.727, -11.248, -3.655, 12.909, -4.57, 5.689, -2.634, -5.918, 12.451, 8.032, 13.574, -10.186, 1.317, 17.451, 14.618, -4.332, -1.113, -2.79, 12.699, -4.958, 8.723, -8.611, -3.575, -8.991, -8.881, -12.58, 10.526, -5.877, -0.957, -1.375, -0.199, -1.088, -9.644, 10.958, 14.033, -0.611, -11.634, -10.582, 7.463, 10.017, -2.224, -11.34, 8.583, -11.905, -3.707, 2.001, 16.487, 13.805, 2.348, 10.752, -0.449, -8.426, -11.5, 6.284, 4.827, -5.083, 3.123, -11.061, -9.554, -11.567, -3.206, -8.909, -1.901, -2.405, 8.852, 5.56, -8.047, -0.877, 7.968, -8.323, -8.094, 14.983, 13.985, -7.877, -14.682, 11.781, 13.854, -2.436, -2.049, 12.942, -9.615, 11.141, -2.663, -2.383, -2.909, 3.068, -10.143, 0.21, 14.919, 8.395, 8.177, 7.223, -10.972, -10.157, 2.51, 14.005, 17.276, 4.06, -12.731, -3.062, 7.818, -1.486, -1.01, 0.52, 4.052, -8.154, -10.11, -5.547, -4.308, 14.705, -4.036, -3.103, -1.815, 5.908, -4.295, 7.871, -4.933, 18.437, -6.646, -10.139, 4.922, 5.783, -5.393, -10.222, -0.596, 6.443, -0.691, -11.213, -12.302, 4.1, 8.747, -1.623, 8.884, -2.779, -3.702, -6.794, 9.746, -4.169, -9.162, -10.659, -11.505, -4.399, -0.588, 3.54, -1.597, 3.004, 6.486, 9.006, 8.939],
                "y": [5.023, 4.54, 5.761, -2.424, -4.593, -0.796, 6.562, -3.9, -2.485, 6.635, -4.053, 0.461, -2.91, 6.495, -2.715, -3.729, -1.793, 2.925, 1.064, -2.761, 3.707, 1.413, 0.682, -0.37, -3.008, -2.245, -1.294, -0.967, 0.463, 7.787, -3.663, -0.568, -5.472, -3.283, 1.902, -1.637, -2.129, -0.313, -3.273, 2.983, -3.165, -4.511, -4.084, 8.656, -2.902, 2.543, 2.14, 1.241, 1.722, -2.76, -3.347, -3.508, 0.1, 5.31, -2.299, -4.537, 1.336, -3.437, -2.277, -1.237, -1.039, 1.879, 0.888, -2.942, 1.246, -5.11, 2.589, 1.742, 5.794, 4.271, -3.292, 0.655, -1.258, -2.894, -2.706, 2.363, 5.329, -3.706, 2.539, 1.261, 5.192, -0.544, 4.459, 3.282, 5.437, -2.514, 4.524, -6.831, 0.445, -0.617, -0.684, -1.83, -0.281, -0.015, -0.171, 2.08, -2.073, 4.171, 2.194, 3.583, 9.961, -2.2, 0.333, 0.051, 0.173, -3.907, -2.326, -1.975, -0.495, -2.09, 4.15, -4.213, 4.735, 4.622, -3.357, -3.742, -2.034, -0.913, 3.56, 0.131, 6.183, 4.518, -7.697, -3.488, -2.129, -4.273, -3.924, 5.766, -1.807, 1.771, -2.314, -0.469, 0.964, -2.029, 4.365, 2.74, -2.006, -0.283, -0.557, -0.382, -2.869, -4.246, 5.213, -4.565, -2.185, -3.883, -0.801, 4.92, 7.697, -6.776, 5.071, 2.461, -2.576, -3.576, -0.957, 5.409, -0.456, -3.108, 0.689, 2.61, -2.043, -1.869]
            }
        },
        "variance_explained": {"PC1": 41.8, "PC2": 7.4},
        "indicators": {
            "Life Expectancy": [58.06, 75.08, 72.39, 51.39, 74.64, 74.29, 71.92, 80.53, 79.08, 68.67, 72.07, 66.81, 77.44, 70.1, 78.84, 71.15, 57.52, 74.58, 57.95, 71.54, 72.69, 54.09, 62.02, 53.94, 80.05, 69.42, 47.39, 49.61, 77.28, 72.82, 73.85, 57.0, 78.01, 52.56, 75.59, 77.17, 78.69, 75.96, 77.92, 59.54, 74.32, 70.56, 73.57, 69.03, 69.66, 72.96, 51.78, 56.53, 66.18, 78.76, 80.02, 61.02, 57.43, 71.05, 78.77, 59.49, 79.5, 72.21, 69.12, 54.59, 52.43, 66.55, 58.82, 71.62, 72.96, 80.69, 64.23, 67.27, 71.62, 68.73, 78.46, 80.0, 80.51, 74.07, 81.93, 72.42, 66.78, 57.63, 64.25, 73.75, 67.92, 61.08, 71.26, 75.75, 49.97, 55.09, 72.14, 78.83, 60.15, 51.61, 73.5, 72.02, 51.8, 79.85, 61.81, 72.29, 74.15, 68.69, 64.98, 74.69, 71.19, 51.28, 61.76, 57.14, 64.1, 79.46, 79.32, 70.47, 53.21, 48.97, 68.7, 79.78, 73.4, 63.87, 75.82, 71.49, 72.29, 69.18, 74.81, 78.23, 72.32, 67.78, 51.9, 73.91, 71.36, 69.99, 64.12, 72.86, 61.41, 73.24, 44.7, 74.3, 77.44, 68.81, 59.18, 77.88, 80.46, 73.27, 60.4, 69.22, 80.43, 80.85, 64.83, 55.4, 72.71, 56.37, 70.65, 73.68, 71.71, 52.14, 69.01, 75.16, 78.82, 77.48, 75.51, 68.52, 68.0, 72.21, 73.6, 62.61, 51.47, 51.25],
            "GDP per Capita": [438.08, 2656.15, 3157.24, 2264.4, 12047.89, 8588.17, 2105.25, 37417.49, 37691.15, 3024.0, 25684.47, 710.66, 13257.93, 3828.68, 35190.37, 3811.39, 796.2, 3359.7, 5156.12, 6741.73, 4639.02, 488.33, 688.8, 1093.39, 34839.79, 2337.97, 384.86, 541.07, 8948.7, 3505.43, 4290.49, 1866.76, 6349.11, 1162.39, 10560.15, 4543.3, 21869.97, 13256.62, 46033.7, 1393.56, 5631.74, 4257.48, 3628.25, None, 2556.47, 11835.77, 2772.06, 323.7, 3617.28, 37032.9, 32910.73, 6610.98, 669.12, 2332.22, 35365.8, 992.03, 18585.58, 6314.31, 2480.18, 576.05, 445.26, 2901.24, 863.98, 1539.77, 9895.26, 43831.07, 940.05, 1980.76, 3787.0, 5047.07, 42634.59, 25712.2, 28816.69, 3927.5, 37598.47, 2662.9, 5528.19, 778.54, 1175.73, 29741.33, None, 962.55, 9827.76, 5409.62, 788.49, 503.02, 10034.8, 79290.07, 397.22, 296.69, 6706.65, 4965.13, 533.3, 17075.67, 1191.34, 6299.44, 7726.29, 1864.02, 1912.5, 5711.76, 2168.17, 414.5, 781.5, 3621.21, 452.41, 39459.75, 26979.35, 1281.44, 376.98, 1422.99, None, 61787.59, 12560.13, 834.21, 7262.43, 3190.26, 3768.03, 1769.95, 8577.17, 17008.36, 5630.71, 6925.18, 456.45, None, None, 2608.7, 1228.88, 14642.14, 1031.7, 4659.06, 347.14, 11382.12, 17239.62, 1456.9, 4875.89, 18955.39, 23115.1, 1922.79, 823.8, 4531.5, 42693.76, 59935.01, 522.2, 574.76, 3865.11, 456.18, 11671.84, 3026.34, 7100.79, 478.73, 2040.2, 35071.23, 35124.38, 43022.93, 9311.08, 1135.67, 2155.94, 6691.63, 1024.64, 842.8, 917.62, 862.1]
        },
        "cluster_averages": {
            "0": {"Life Expectancy": 78.33, "GDP per Capita": 31226.96},
            "1": {"Life Expectancy": 56.74, "GDP per Capita": 1207.21},
            "2": {"Life Expectancy": 71.5, "GDP per Capita": 5341.95},
            "3": {"Life Expectancy": 71.48, "GDP per Capita": 4918.71}
        }
    }
    return data

data = load_data()

# Create DataFrame
df = pd.DataFrame({
    'Country': data['countries'],
    'Cluster': data['clusters'],
    'Cluster_Name': [data['cluster_labels'][str(c)] for c in data['clusters']]
})

for method in data['embeddings']:
    df[f'{method}_x'] = data['embeddings'][method]['x']
    df[f'{method}_y'] = data['embeddings'][method]['y']

for indicator, values in data['indicators'].items():
    df[indicator] = values

cluster_colors = {0: '#00d4aa', 1: '#ef4444', 2: '#f59e0b', 3: '#8b5cf6'}

# ============== SIDEBAR ==============
with st.sidebar:
    st.markdown("## üéõÔ∏è Controls")
    method = st.radio("**Projection Method**", ["PCA", "t-SNE", "UMAP", "Isomap"])
    st.markdown("---")
    color_by = st.selectbox("**Color By**", ["Cluster", "Life Expectancy", "GDP per Capita"])
    st.markdown("---")
    selected_country = st.selectbox("**üîç Find Country**", [""] + sorted(data['countries']))
    st.markdown("---")
    st.markdown("**Filter Clusters**")
    show_clusters = {int(i): st.checkbox(name, value=True, key=f"c{i}") for i, name in data['cluster_labels'].items()}

# ============== MAIN ==============
st.markdown('<h1 class="main-header">üåç Global Health Explorer</h1>', unsafe_allow_html=True)
st.markdown('<p class="sub-header">Dimensionality Reduction Analysis ‚Ä¢ 162 Countries ‚Ä¢ 1990-2019</p>', unsafe_allow_html=True)

mask = df['Cluster'].isin([c for c, show in show_clusters.items() if show])
df_filtered = df[mask].copy()

col1, col2 = st.columns([2, 1])

with col1:
    st.markdown(f"### {method} Projection")
    x_col, y_col = f'{method}_x', f'{method}_y'
    
    if color_by == "Cluster":
        fig = px.scatter(df_filtered, x=x_col, y=y_col, color='Cluster_Name',
            color_discrete_map={'Developed Nations': '#00d4aa', 'Least Developed': '#ef4444', 
                               'Emerging Economies': '#f59e0b', 'Developing Nations': '#8b5cf6'},
            hover_name='Country', hover_data={x_col: False, y_col: False, 'Life Expectancy': ':.1f'})
    else:
        fig = px.scatter(df_filtered, x=x_col, y=y_col, color=color_by,
            color_continuous_scale='RdYlGn', hover_name='Country',
            hover_data={x_col: False, y_col: False, 'Life Expectancy': ':.1f'})
    
    if selected_country:
        cd = df[df['Country'] == selected_country]
        if len(cd) > 0:
            fig.add_trace(go.Scatter(x=cd[x_col], y=cd[y_col], mode='markers+text',
                marker=dict(size=20, color='white', line=dict(width=3, color='#ff6b6b')),
                text=[selected_country], textposition='top center',
                textfont=dict(size=14, color='white'), showlegend=False))
    
    fig.update_traces(marker=dict(size=10, line=dict(width=1, color='rgba(0,0,0,0.3)')))
    fig.update_layout(
        plot_bgcolor='rgba(0,0,0,0)', paper_bgcolor='rgba(0,0,0,0)',
        font=dict(color='#e8e8e8'),
        xaxis=dict(title=f"Dim 1" + (f" ({data['variance_explained']['PC1']}%)" if method=='PCA' else ''),
                  gridcolor='rgba(255,255,255,0.1)'),
        yaxis=dict(title=f"Dim 2" + (f" ({data['variance_explained']['PC2']}%)" if method=='PCA' else ''),
                  gridcolor='rgba(255,255,255,0.1)'),
        height=500, margin=dict(l=60, r=20, t=40, b=60))
    st.plotly_chart(fig, use_container_width=True)

with col2:
    st.markdown("### Cluster Profiles")
    for cid in range(4):
        if show_clusters.get(cid, True):
            name = data['cluster_labels'][str(cid)]
            avg = data['cluster_averages'][str(cid)]
            cnt = sum(1 for c in data['clusters'] if c == cid)
            color = cluster_colors[cid]
            st.markdown(f"""
            <div class="metric-card">
                <span class="cluster-badge cluster-{cid}">{name}</span>
                <span style="color:#888;float:right;">{cnt} countries</span>
                <div style="margin-top:0.5rem;font-size:0.9rem;">
                    <span style="color:#888;">Life Exp:</span> <span style="color:{color}">{avg['Life Expectancy']:.1f} yrs</span><br>
                    <span style="color:#888;">GDP/cap:</span> <span style="color:{color}">${avg['GDP per Capita']:,.0f}</span>
                </div>
            </div>
            """, unsafe_allow_html=True)

if selected_country:
    st.markdown("---")
    st.markdown(f"### üìç {selected_country}")
    idx = data['countries'].index(selected_country)
    cid = data['clusters'][idx]
    cols = st.columns(3)
    cols[0].metric("Cluster", data['cluster_labels'][str(cid)])
    le = data['indicators']['Life Expectancy'][idx]
    cols[1].metric("Life Expectancy", f"{le:.1f} yrs" if le else "N/A")
    gdp = data['indicators']['GDP per Capita'][idx]
    cols[2].metric("GDP per Capita", f"${gdp:,.0f}" if gdp else "N/A")

st.markdown("---")
st.caption("Assessment 3 ‚Ä¢ Data Analytics & Visualisation (RAI-7002) ‚Ä¢ Data: WHO, World Bank, UN")
